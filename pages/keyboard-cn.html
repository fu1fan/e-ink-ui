<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./src/bootstrap.min.css">
    <link rel="stylesheet" href="./src/paper.css">
    <title>中文键盘</title>
    <style>
        button,
        button:hover,
        button:active,
        button:focus {
            border: none;
        }

        button {
            height: 20px;
        }

        #keyboard {
            width: 400px;
        }

        #textInp {
            border-bottom: 1px solid black;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
        }

        .tp {
            font-family: px12;
            font-size: 12px;
        }
    </style>
</head>

<body>
    <div id="textInp" class="pl-1 pr-1"></div>
    <div id="keyboard" class="pl-1 pr-1 pt-4">
        <div class="keyrow">
            <button class="keys" shift="！">1</button>
            <button class="keys" shift="">2</button>
            <button class="keys" shift="">3</button>
            <button class="keys" shift="￥">4</button>
            <button class="keys" shift="">5</button>
            <button class="keys" shift="……">6</button>
            <button class="keys" shift="">7</button>
            <button class="keys" shift="">8</button>
            <button class="keys" shift="（">9</button>
            <button class="keys" shift="）">0</button>
            <button class="keys" shift="——">-</button>
            <button class="keys" shift="">=</button>
            <button class="keys" shift="·">~</button>
        </div>
        <div class="keyrow">
            <button class="keys" shift="Q">q</button>
            <button class="keys" shift="W">w</button>
            <button class="keys" shift="E">e</button>
            <button class="keys" shift="R">r</button>
            <button class="keys" shift="T">t</button>
            <button class="keys" shift="Y">y</button>
            <button class="keys" shift="U">u</button>
            <button class="keys" shift="I">i</button>
            <button class="keys" shift="O">o</button>
            <button class="keys" shift="P">p</button>
            <button class="keys" shift="「">【</button>
            <button class="keys" shift="」">】</button>
            <button class="keys" shift="|">、</button>
        </div>
        <div class="keyrow">
            <button class="keys" shift="A">a</button>
            <button class="keys" shift="S">s</button>
            <button class="keys" shift="D">d</button>
            <button class="keys" shift="F">f</button>
            <button class="keys" shift="G">g</button>
            <button class="keys" shift="H">h</button>
            <button class="keys" shift="J">j</button>
            <button class="keys" shift="K">k</button>
            <button class="keys" shift="L">l</button>
            <button class="backspace">&lt;</button>
            <button class="keys" shift="：">；</button>
            <button class="keys" shift='"'>'</button>
            <button class="enter">好</button>
        </div>
        <div class="keyrow">
            <button class="keys" shift="Z">z</button>
            <button class="keys" shift="X">x</button>
            <button class="keys" shift="C">c</button>
            <button class="keys" shift="V">v</button>
            <button class="keys" shift="B">b</button>
            <button class="keys" shift="N">n</button>
            <button class="keys" shift="M">m</button>
            <button class="space">空格</button>
            <button class="shift">↑</button>
            <button class="keys" shift="《">，</button>
            <button class="keys" shift="》">。</button>
            <button class="keys" shift="？">/</button>
        </div>
    </div>
    <script src="./src/jquery.min.js"></script>
    <script src="./src/piapi.js"></script>
    <script>
        function upd() {
            piapi.updateImage();
        }


        var text = "";
        var tp = "";

        var textEN = "";

        var shift = false;
        var capslock = false;

        if (GetUrlByParamName("text")) {
            $("#textInp").html(GetUrlByParamName("text"));
            text = GetUrlByParamName("text");
        };

        function update() {
            $("#textInp").html(text + "<span class='tp'>" + tp + "</span>");
            upd();
        }

        function getCN() {
            $.getJSON("https://suggestion.baidu.com/su?wd=" + textEN + "&cb=?", function (data) {
                var minlen = data.s[0];
                for (var i = 0; i < data.s.length; i++) {
                    if (data.s[i].length < minlen.length) minlen = data.s[i];
                }
                if (minlen) {
                    tp = minlen;
                    update();
                }
            })
        }

        //点击shift键时，按键的html与shift属性值互换
        $(".shift").click(function () {
            if (!shift && !capslock) {
                shiftSwitch();
            } else if (shift && !capslock) {
                capslock = true;
                $(".shift").css("transform", "rotate(45deg)");
                upd();
            } else {
                shiftSwitch();
                capslock = false;
                $(".shift").css("transform", "rotate(0deg)");
            }
        })
        function shiftSwitch() {
            $(".keys").each(function () {
                var html = $(this).html();
                $(this).html($(this).attr("shift"));
                $(this).attr("shift", html);
            })
            shift = !shift;
            upd();
        }
        //点击backspace键时，删除输入框中的内容
        $(".backspace").click(function () {
            if (textEN != "") {
                textEN = textEN.substring(0, textEN.length - 1);
                if (textEN != ""){
                    getCN();
                } else {
                    tp = "";
                    update();
                }
            }else{
                text = text.substring(0, text.length - 1);
                update();
            }
        })
        //点击空格键时，输入框中添加空格
        $(".space").click(function () {
            if (tp != "") {
                text += tp;
                tp = "";
                textEN = "";
                update();
            }else{
                text += " ";
            }
        })
        //点击按键时，输入框中添加按键的内容
        $(".keys").click(function () {
            textEN += $(this).text();
            if (shift && !capslock) shiftSwitch();
            getCN();
        })

        $(window).scroll(upd);

        function GetUrlByParamName(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var URL = decodeURI(window.location.search);
            var r = URL.substr(1).match(reg);
            if (r != null) {
                //decodeURI() 函数可对 encodeURI() 函数编码过的 URI 进行解码  
                return decodeURI(r[2]);
            };
            return null;
        }

        var inputid;
        if (GetUrlByParamName("inputid")) {
            inputid = GetUrlByParamName("inputid");
        } else {
            inputid = "input";
        };


        $(".enter").click(function () {
            if (textEN != "") {
                text += textEN;
                textEN = "";
                tp = "";
                update();
            } else {
                if (GetUrlByParamName("from")) {
                    location.href = "./" + GetUrlByParamName("from") + "?text=" + text + "&inputid=" + inputid;
                } else {
                    location.href = "./main.html?refresh=1";
                }
            }
        })

        upd();
    </script>
</body>

</html>